<!DOCTYPE html> <html lang="th"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>PC MASTER PRO - Ultimate Builder</title> <script src="https://cdn.tailwindcss.com"></script> <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Kanit:wght@300;400;600&display=swap" rel="stylesheet"> <style> body { font-family: 'Kanit', sans-serif; background: #020617; color: #f8fafc; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; } .font-gaming { font-family: 'Orbitron', sans-serif; } .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); } .neon-border { border: 1px solid #22d3ee; box-shadow: 0 0 15px rgba(34, 211, 238, 0.3); } .tab-active { color: #22d3ee; border-bottom: 3px solid #22d3ee; } .animate-fade-in { animation: fadeIn 0.3s ease forwards; } @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } } #category-container::-webkit-scrollbar { display: none; } .delete-btn { position: absolute; top: 10px; right: 10px; } </style> </head> <body class="min-h-screen pb-10">
  <nav class="glass sticky top-0 z-50 px-4 md:px-8 py-4 flex justify-between items-center mb-6">
    <div class="text-lg md:text-2xl font-gaming font-bold text-cyan-400 tracking-widest uppercase cursor-pointer" onclick="location.reload()">PC MASTER</div>
    <div class="flex gap-3 md:gap-6 items-center">
        <button onclick="switchTab('catalog')" id="tab-catalog" class="tab-active py-1 text-[10px] md:text-sm font-gaming uppercase transition">Catalog</button>
        <button onclick="switchTab('builder')" id="tab-builder" class="py-1 text-[10px] md:text-sm font-gaming uppercase text-gray-400 transition hover:text-cyan-400">Builder</button>
        <button onclick="openAdminModal()" class="px-3 py-1.5 bg-cyan-600/20 text-cyan-400 rounded-lg border border-cyan-500/50 hover:bg-cyan-600 hover:text-white transition text-[9px] md:text-[10px] font-bold">
            + ADD PRODUCT
        </button>
    </div>
</nav>

<div class="max-w-7xl mx-auto px-4 md:px-6">
    <section id="section-catalog" class="block">
        <div class="flex flex-col mb-6 gap-4">
            <h2 class="text-2xl md:text-3xl font-bold font-gaming uppercase italic text-cyan-400 tracking-tighter">Inventory</h2>
            <div id="category-container" class="flex gap-2 overflow-x-auto pb-2 w-full whitespace-nowrap scroll-smooth"></div>
        </div>
        <div id="product-grid" class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-20"></div>
    </section>

    <section id="section-builder" class="hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-20">
            <div class="lg:col-span-2 space-y-3">
                <h2 class="text-2xl md:text-3xl font-bold font-gaming mb-4 uppercase italic text-cyan-400">Custom Build</h2>
                <div id="builder-slots" class="space-y-3"></div>
            </div>
            <div class="lg:col-span-1">
                <div class="glass p-5 rounded-2xl sticky top-24 neon-border">
                    <h3 class="text-lg font-bold mb-4 font-gaming text-cyan-400 text-center uppercase tracking-widest">Summary</h3>
                    <div id="summary-items" class="space-y-2 mb-6 text-xs md:text-sm text-gray-300"></div>
                    <div class="border-t border-gray-700 pt-4 flex flex-col items-end gap-1">
                        <span class="text-[10px] text-gray-400 font-gaming uppercase">Total Amount</span>
                        <div class="flex items-baseline gap-2">
                            <span id="total-price-display" class="text-2xl md:text-3xl font-bold text-green-400 font-gaming">0</span>
                            <span class="text-green-400 font-bold font-gaming text-sm">₭</span>
                        </div>
                    </div>
                    <button onclick="window.print()" class="w-full mt-6 bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl transition uppercase text-[10px] font-gaming">Print (PDF)</button>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Admin Modal -->
<div id="admin-modal" class="fixed inset-0 bg-black/95 hidden z-[110] flex items-center justify-center p-2 md:p-4">
    <div class="glass w-full max-w-lg rounded-2xl p-6 md:p-8 neon-border shadow-2xl overflow-y-auto max-h-[95vh]">
        <h3 id="admin-title" class="text-xl font-bold text-cyan-400 mb-6 font-gaming uppercase tracking-wider text-center">Manage Product</h3>
        <form id="product-form" class="space-y-4">
            <input type="hidden" id="p-id">
            <div>
                <label class="block text-[10px] text-gray-400 mb-1 uppercase font-bold">Product Name</label>
                <input type="text" id="p-name" class="w-full bg-slate-800 border border-gray-700 p-3 rounded-lg text-white focus:border-cyan-400 outline-none text-sm transition" required>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-[10px] text-gray-400 mb-1 uppercase font-bold">Category</label>
                    <select id="p-category" onchange="renderDynamicSpecs()" class="w-full bg-slate-800 border border-gray-700 p-3 rounded-lg text-white text-sm outline-none focus:border-cyan-400">
                        <option value="CPU">CPU</option>
                        <option value="Motherboard">Motherboard</option>
                        <option value="GPU">GPU</option>
                        <option value="RAM">RAM</option>
                        <option value="PSU">PSU</option>
                        <option value="Case">Case</option>
                        <option value="Storage">Storage</option>
                    </select>
                </div>
                <div>
                    <label class="block text-[10px] text-gray-400 mb-1 uppercase font-bold">Price (₭)</label>
                    <input type="number" id="p-price" class="w-full bg-slate-800 border border-gray-700 p-3 rounded-lg text-white text-sm focus:border-cyan-400 outline-none" required>
                </div>
            </div>
            <div id="dynamic-specs-container" class="space-y-4 pt-2"></div>
            <div>
                <label class="block text-[10px] text-gray-400 mb-1 uppercase font-bold">Image File</label>
                <input type="file" id="p-image-file" accept="image/*" class="w-full text-[10px] text-gray-400 file:mr-3 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-cyan-600 file:text-white cursor-pointer hover:file:bg-cyan-500">
                <div id="image-preview" class="mt-3 text-center">
                    <img id="preview-img" src="" class="max-h-40 mx-auto rounded-lg hidden">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button type="button" onclick="closeAdminModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 py-3 rounded-xl font-bold uppercase text-[10px] transition">Cancel</button>
                <button type="submit" id="btn-save" class="flex-1 bg-cyan-600 hover:bg-cyan-500 py-3 rounded-xl font-bold uppercase text-[10px] transition">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Product Picker Modal -->
<div id="modal" class="fixed inset-0 bg-black/90 hidden z-[100] flex items-end md:items-center justify-center p-0 md:p-4">
    <div class="glass w-full max-w-4xl h-[90vh] md:h-auto md:max-h-[85vh] overflow-hidden rounded-t-3xl md:rounded-3xl flex flex-col border border-cyan-500/30">
        <div class="p-5 border-b border-gray-700 flex justify-between items-center">
            <h3 id="modal-title" class="text-lg font-bold text-cyan-400 font-gaming uppercase tracking-widest">Select Part</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-white text-3xl transition">&times;</button>
        </div>
        <div id="modal-list" class="grid grid-cols-1 md:grid-cols-2 gap-3 p-4 overflow-y-auto"></div>
    </div>
</div>

<script>
let allProducts = [];
let selectedParts = {};
const categories = ["CPU", "Motherboard", "GPU", "RAM", "PSU", "Case", "Storage"];
const STORAGE_KEY = "pc_master_products";
const BUILDER_KEY = "pc_master_builder";

// ============ LocalStorage Functions ============
function saveProducts() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(allProducts));
}

function loadProducts() {
    const stored = localStorage.getItem(STORAGE_KEY);
    return stored ? JSON.parse(stored) : [];
}

function saveBuilder() {
    localStorage.setItem(BUILDER_KEY, JSON.stringify(selectedParts));
}

function loadBuilder() {
    const stored = localStorage.getItem(BUILDER_KEY);
    return stored ? JSON.parse(stored) : {};
}

function generateId() {
    return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// ============ Initialize ============
function init() {
    allProducts = loadProducts();
    selectedParts = loadBuilder();
    renderCategoryButtons();
    filterCatalog('All');
    renderBuilderSlots();
    updateTotal();
}

// ============ Catalog Logic ============
function filterCatalog(targetCat) {
    const grid = document.getElementById('product-grid');
    const filtered = targetCat === 'All' ? allProducts : allProducts.filter(p => p.category === targetCat);
    
    grid.innerHTML = filtered.map(p => `
        <div class="glass p-3 md:p-5 rounded-2xl flex flex-col group border border-white/5 relative animate-fade-in transition-all hover:neon-border">
            <button onclick="deleteProduct('${p.id}')" class="delete-btn bg-red-600/80 hover:bg-red-600 text-white px-2 py-1 rounded text-[9px] font-bold opacity-0 group-hover:opacity-100 transition">DELETE</button>
            <div class="bg-white/5 rounded-xl p-2 mb-3 h-32 md:h-40 flex items-center justify-center overflow-hidden">
                <img src="${p.image_url}" class="max-h-full object-contain group-hover:scale-110 transition duration-500">
            </div>
            <div class="text-[8px] text-cyan-400 font-bold uppercase mb-1 tracking-widest">${p.category}</div>
            <div class="text-[11px] md:text-sm text-white font-bold mb-2 h-8 line-clamp-2 leading-tight">${p.name}</div>
            <div class="flex justify-between items-end mt-auto">
                <div class="text-sm md:text-lg text-green-400 font-bold font-gaming">${Number(p.price).toLocaleString()} <span class="text-[10px]">₭</span></div>
                <button onclick="openEditModal('${p.id}')" class="bg-cyan-600/20 hover:bg-cyan-600 text-cyan-400 hover:text-white px-3 py-1 rounded-lg border border-cyan-500/50 transition-all text-[9px] font-bold uppercase">
                    EDIT
                </button>
            </div>
        </div>`).join('');
}

// ============ Admin & Edit Logic ============
function openEditModal(productId) {
    const product = allProducts.find(p => p.id == productId);
    if (!product) return;

    document.getElementById('admin-modal').classList.remove('hidden');
    document.getElementById('admin-title').innerText = "EDIT PRODUCT";
    document.getElementById('btn-save').innerText = "UPDATE PRODUCT";

    document.getElementById('p-id').value = product.id;
    document.getElementById('p-name').value = product.name;
    document.getElementById('p-category').value = product.category;
    document.getElementById('p-price').value = product.price;

    renderDynamicSpecs();

    // Show existing image
    const previewImg = document.getElementById('preview-img');
    if (product.image_url && !product.image_url.includes('placeholder')) {
        previewImg.src = product.image_url;
        previewImg.classList.remove('hidden');
    }

    if (product.specs) {
        setTimeout(() => {
            Object.entries(product.specs).forEach(([key, val]) => {
                const el = document.getElementById('spec-' + key);
                if (el) el.value = val;
            });
        }, 50);
    }
}

function openAdminModal() {
    document.getElementById('p-id').value = "";
    document.getElementById('product-form').reset();
    document.getElementById('admin-title').innerText = "ADD NEW PRODUCT";
    document.getElementById('btn-save').innerText = "SAVE PRODUCT";
    document.getElementById('preview-img').classList.add('hidden');
    renderDynamicSpecs();
    document.getElementById('admin-modal').classList.remove('hidden');
}

function deleteProduct(productId) {
    if (confirm("ลบสินค้านี้ใช่หรือไม่?")) {
        allProducts = allProducts.filter(p => p.id !== productId);
        saveProducts();
        filterCatalog('All');
    }
}

// Image preview
document.getElementById('p-image-file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const previewImg = document.getElementById('preview-img');
            previewImg.src = event.target.result;
            previewImg.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    }
});

// Form submission
document.getElementById('product-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('btn-save');
    const pId = document.getElementById('p-id').value;

    btn.disabled = true;
    btn.innerText = "Processing...";

    try {
        const specInputs = document.querySelectorAll('[id^="spec-"]');
        const specs = {};
        specInputs.forEach(input => {
            const key = input.id.replace('spec-', '');
            specs[key] = input.value;
        });

        const productData = {
            name: document.getElementById('p-name').value,
            category: document.getElementById('p-category').value,
            price: parseFloat(document.getElementById('p-price').value),
            specs: specs,
            image_url: "https://via.placeholder.com/150"
        };

        // Handle image
        const fileInput = document.getElementById('p-image-file');
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                productData.image_url = event.target.result; // Base64
                saveProductToStorage(pId, productData, btn);
            };
            reader.readAsDataURL(file);
        } else {
            // If editing and no new image, keep old image
            if (pId) {
                const oldProduct = allProducts.find(p => p.id === pId);
                if (oldProduct) {
                    productData.image_url = oldProduct.image_url;
                }
            }
            saveProductToStorage(pId, productData, btn);
        }
    } catch (err) {
        alert("ผิดพลาด: " + err.message);
        btn.disabled = false;
        btn.innerText = btn.innerText.replace("Processing...", "Save Changes");
    }
});

function saveProductToStorage(pId, productData, btn) {
    try {
        if (pId) {
            // Update existing
            const index = allProducts.findIndex(p => p.id === pId);
            if (index !== -1) {
                allProducts[index] = { ...allProducts[index], ...productData };
            }
        } else {
            // Add new
            productData.id = generateId();
            allProducts.push(productData);
        }

        saveProducts();
        alert("สำเร็จ!");
        closeAdminModal();
        filterCatalog('All');
    } catch (err) {
        alert("ผิดพลาด: " + err.message);
    } finally {
        btn.disabled = false;
        btn.innerText = "Save Changes";
    }
}

// ============ Dynamic Specs ============
function renderDynamicSpecs() {
    const cat = document.getElementById('p-category').value;
    const container = document.getElementById('dynamic-specs-container');
    const inputStyle = "w-full bg-slate-800 border border-gray-700 p-3 rounded-lg text-white text-sm outline-none focus:border-cyan-400 transition";
    const labelStyle = "block text-[10px] text-gray-400 mb-1 uppercase font-bold";
    let html = "";
    
    switch(cat) {
        case 'CPU':
            html = `<div><label class="${labelStyle}">Cores/Threads</label><input type="text" id="spec-cores" class="${inputStyle}" placeholder="e.g., 8-Core / 16-Thread"></div>`;
            break;
        case 'GPU':
            html = `<div><label class="${labelStyle}">VRAM</label><input type="text" id="spec-vram" class="${inputStyle}" placeholder="e.g., 8GB GDDR6"></div>`;
            break;
        case 'RAM':
            html = `<div><label class="${labelStyle}">Capacity</label><input type="text" id="spec-capacity" class="${inputStyle}" placeholder="e.g., 16GB DDR4"></div>`;
            break;
        case 'Storage':
            html = `<div><label class="${labelStyle}">Capacity</label><input type="text" id="spec-storage-capacity" class="${inputStyle}" placeholder="e.g., 1TB SSD"></div>`;
            break;
        default:
            html = `<p class="text-[10px] text-gray-500 italic">No additional specs required.</p>`;
    }
    container.innerHTML = html;
}

function renderCategoryButtons() {
    const container = document.getElementById('category-container');
    container.innerHTML = `<button onclick="filterCatalog('All')" class="px-5 py-2 glass rounded-full text-[10px] font-bold uppercase shrink-0 hover:border-cyan-500 transition">All Items</button>` +
        categories.map(cat => `<button onclick="filterCatalog('${cat}')" class="px-5 py-2 glass rounded-full text-[10px] font-bold uppercase shrink-0 hover:border-cyan-500 transition">${cat}</button>`).join('');
}

// ============ Builder Logic ============
function renderBuilderSlots() {
    const container = document.getElementById('builder-slots');
    container.innerHTML = categories.map(cat => {
        const item = selectedParts[cat];
        return `<div class="glass p-3 rounded-2xl flex justify-between items-center border-l-4 ${item ? 'border-cyan-400' : 'border-gray-700'} animate-fade-in">
            <div class="flex items-center gap-3">
                ${item ? `<img src="${item.image_url}" class="w-10 h-10 object-contain bg-white rounded p-1">` : `<div class="w-10 h-10 bg-slate-800 rounded flex items-center justify-center text-[10px] text-gray-600 font-gaming">?</div>`}
                <div>
                    <div class="text-[8px] text-cyan-500 font-bold uppercase">${cat}</div>
                    <div class="text-[10px] md:text-xs truncate max-w-[150px] ${item ? 'text-white font-bold' : 'text-gray-600 italic'}">${item ? item.name : 'Select part...'}</div>
                </div>
            </div>
            <button onclick="openPicker('${cat}')" class="bg-slate-800 hover:bg-cyan-600 px-4 py-2 rounded-xl text-[9px] font-bold uppercase transition border border-white/5">${item ? 'Change' : 'Add'}</button>
        </div>`;
    }).join('');
}

function openPicker(cat) {
    const list = document.getElementById('modal-list');
    document.getElementById('modal-title').innerText = `Select ${cat}`;
    const filtered = allProducts.filter(p => p.category === cat);
    
    if (filtered.length === 0) {
        list.innerHTML = `<div class="col-span-2 text-center text-gray-400 py-8">ยังไม่มีสินค้าในหมวด ${cat}</div>`;
    } else {
        list.innerHTML = filtered.map(p => `<div class="glass rounded-xl p-3 flex gap-3 items-center border border-white/5 hover:border-cyan-500/50 transition"><img src="${p.image_url}" class="w-14 h-14 object-contain rounded bg-white p-1"><div class="flex-1 overflow-hidden"><div class="font-bold text-xs text-white truncate">${p.name}</div><div class="text-green-400 font-bold text-xs mt-1">${Number(p.price).toLocaleString()} ₭</div></div><button onclick="confirmSelection('${cat}', '${p.id}')" class="bg-cyan-600 px-3 py-2 rounded-lg text-[10px] font-bold uppercase hover:bg-cyan-500 transition shadow-lg">Select</button></div>`).join('');
    }
    
    document.getElementById('modal').classList.remove('hidden');
}

function confirmSelection(cat, id) {
    selectedParts[cat] = allProducts.find(p => p.id == id);
    saveBuilder();
    renderBuilderSlots();
    updateTotal();
    closeModal();
}

function updateTotal() {
    let total = 0;
    const container = document.getElementById('summary-items');
    container.innerHTML = Object.entries(selectedParts).map(([cat, p]) => {
        total += Number(p.price);
        return `<div class="flex justify-between items-center bg-white/5 p-2 rounded"><span>${cat}</span><span class="text-cyan-400 font-gaming">${Number(p.price).toLocaleString()} ₭</span></div>`;
    }).join('');
    document.getElementById('total-price-display').innerText = total.toLocaleString();
}

// ============ Tab Switching ============
function switchTab(tab) {
    document.getElementById('section-catalog').classList.toggle('hidden', tab !== 'catalog');
    document.getElementById('section-builder').classList.toggle('hidden', tab !== 'builder');
    document.getElementById('tab-catalog').className = tab === 'catalog' ? 'tab-active py-1 text-[10px] md:text-sm font-gaming uppercase transition' : 'py-1 text-[10px] md:text-sm font-gaming uppercase text-gray-400 transition';
    document.getElementById('tab-builder').className = tab === 'builder' ? 'tab-active py-1 text-[10px] md:text-sm font-gaming uppercase transition' : 'py-1 text-[10px] md:text-sm font-gaming uppercase text-gray-400 transition';
}

// ============ Modals ============
function closeAdminModal() {
    document.getElementById('admin-modal').classList.add('hidden');
}

function closeModal() {
    document.getElementById('modal').classList.add('hidden');
}

// Initialize on load
init();
</script>
